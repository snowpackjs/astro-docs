---
import { getLanguageFromURL } from '../util';
import CardsNav from './NavGrid/CardsNav.astro';

interface Frontmatter {
	title: string;
	service: string;
	stub: boolean;
}

const lang = getLanguageFromURL(Astro.url.pathname);

const pages = await Astro.glob<Frontmatter>('../pages/en/guides/cms/*.md');
const links = pages
	.sort((a, b) => {
		// Sort full guides before stubs.
		if (a.frontmatter.stub && !b.frontmatter.stub) return 1;
		if (!a.frontmatter.stub && b.frontmatter.stub) return -1;
		// If theyâ€™re both stubs, or neither stubs, sort alphabetically.
		return a.frontmatter.service.toLowerCase() > b.frontmatter.service.toLowerCase() ? 1 : -1;
	})
	.map((page) => {
		const { service } = page.frontmatter;
		const pageUrl = page.url!.replace('/en/', `/${lang}/`) + '/';
		const slug = page.url!.split('/').pop();
		return { title: service, href: pageUrl, logo: slug as any };
	});
---

<section class="cms-nav">
	<CardsNav minimal links={links} />
</section>

<style>
	.cms-nav > :global(*) {
		margin-top: -2rem;
	}

	.cms-nav > :global(* + *) {
		margin-top: -3rem;
	}

	.cms-nav :global(.scope) {
		font-weight: normal;
		color: var(--theme-text-lighter);
	}

	h3 {
		margin-bottom: 0;
	}
</style>
