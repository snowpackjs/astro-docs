---
title: 国际化
description: 学习如何在Astro中使用i18n路由。
i18nReady: false
---

import FileTree from '~/components/FileTree.astro'
import Since from '~/components/Since.astro'

Astro的国际化(i18n)特性允许您根据国际用户的需要对您的项目进行改造。


## i18n路由

<p><Since v="3.5.0" /></p>

Astro的i18n路由允许您添加多语言内容，并支持配置默认语言、计算相应语言页面的url以及接受访客浏览器提供的首选语言。您还可以在每种语言的基础上指定备选语言，以便您的访客始终可以被定向到您网站上的现有内容。

这个路由 API 帮助您生成、使用和验证您的多语言网站生成的 URL。这个 API 还在不断开发与完善中，因此请您定期查看最新的文档并更新API，以获取最新的功能。


### 配置i18n路由

1. 通过向您的 Astro 配置添加一个 i18n 对象来启用路由选项，其中包括[默认语言(`defaultLocale`)和支持的所有语言的列表(`locales`)](#defaultlocale-and-locales)：

   ```js title="astro.config.mjs"
   import { defineConfig } from "astro/config"
   export default defineConfig({
     i18n: {
       defaultLocale: "en",
       locales: ["en", "es", "pt-br"]
     }
   })
   ```
  
2. 基于你倾向的`默认语言`的URL路径，选择和配置[`路由`](#路由)：

  - `"prefixDefaultLocale: false"` (默认): 你设置的默认语言URL将**不会**具有类似于`/[locale]/`的前缀，而其他语言将包括这个前缀。

  - `"prefixDefaultLocale: true"`: 包括你的默认语言在内的所有语言的URL都将包含`/[locale]/`的前缀。

    ```js title="astro.config.mjs" ins={7}
    import { defineConfig } from "astro/config"
    export default defineConfig({
      i18n: {
        defaultLocale: "en",
        locales: ["es", "en", "fr"],
        routing: {
            prefixDefaultLocale: false
        }
      }
    })
    ```

3. 按照语言组织您的内容文件夹，将本地化内容放在相应语言的文件夹中。你的文件夹名称必须与 locales 中的语言项完全匹配，你的文件夹组织结构必须与在[`路由`](#路由)中设置的 URL 路径相匹配。

    只有当你配置 `prefixDefaultLocale: true` 时，Astro才为你的 `defaultLocale` 生成一个默认语言的文件夹。

    <FileTree>
    - src
      - pages
        - about.astro
        - index.astro
        - es
          - about.astro
          - index.astro
        - pt-br
          - about.astro
          - index.astro
    </FileTree>

    :::注意
    本地化文件夹不需要位于 /pages/ 文件夹的根目录。
    在 `src/pages/` 的任何位置创建单独的 `/[locale]/` 文件夹，Astro 的[基于文件的路由](/zh-cn/guides/routing/)将在相应的 URL 路径创建您的页面。
    :::
  
4. 配置了 i18n 路由之后，你现在可以使用 [`astro:i18n`](#astroi18n虚拟化模块) 模块提供的 [`getRelativeLocaleURL()`](#getrelativelocaleurl) 辅助函数来计算站点内页面的链接。它将始终提供正确的本地化路由，并可以帮助你正确地使用或检查站点上的 URL。你也可以手动编写对应的URL。

    ```astro title="src/pages/es/index.astro"
    ---
    import { getRelativeLocaleUrl } from 'astro:i18n';

    // defaultLocale is "es"
    const aboutURL=getRelativeLocaleUrl("es", "about");
    ---

    <a href="/get-started/">¡Vamos!</a>
    <a href={getRelativeLocaleUrl('es', 'blog')}>Blog</a>
    <a href={aboutURL}>Acerca</a> 
    ```

### `routing`

Astro内置的基于文件的路由会根据你在 `src/pages/` 中的文件结构自动生成 URL 路由。当你配置 i18n 路由时，`routing` 值允许你指定文件结构（以及生成的相应 URL 路径），以便在项目中使用辅助函数来生成、使用和验证路由。


#### `prefixDefaultLocale: false`

```js title="astro.config.mjs" ins={7}
import { defineConfig } from "astro/config"
export default defineConfig({
  i18n: {
    defaultLocale: "en",
    locales: ["es", "en", "fr"],
    routing: {
        prefixDefaultLocale: false
    }
  }
})
```

这是 **默认** 值。当你的默认语言的 URL **不** 需要 `/[locale]/` 前缀，并且你的默认语言文件存在于 `src/pages/` 的根目录时，可以设置此选项。

- `src/pages/blog.astro` 将产生路由 `example.com/blog/`
- `src/pages/fr/blog.astro` 将产生路由 `example.com/fr/blog/`
- 如果在 `src/pages/es/blog.astro` 中没有文件，则路由 `example.com/es/blog/` 将会返回404状态码，除非你指定了 [回退策略](#回退)。


#### `prefixDefaultLocale: true`

```js title="astro.config.mjs" ins={7}
import { defineConfig } from "astro/config"
export default defineConfig({
  i18n: {
    defaultLocale: "en",
    locales: ["es", "en", "fr"],
    routing: {
        prefixDefaultLocale: true
    }
  }
})
```

当所有路由在其URL中都具有`/locale/`前缀，并且所有页面内容文件，包括您的`defaultLocale`的文件，都存在于本地化文件夹中时，请设置此选项：

    <FileTree>
    - src
      - pages
        - **index.astro** // Note: this file is always required
        - en
          - index.astro
          - about.astro
        - es
          - about.astro
          - index.astro
        - pt-br
          - about.astro
          - index.astro
    </FileTree>

- 没有任何语言前缀的URL(e.g. `example.com/blog/`)将返回404 (not found)状态码。

#### `redirectToDefaultLocale`

<p><Since v="4.2.0" /></p>

配置由 `src/pages/index.astro` 生成的主页URL (`/`)是否会重定向到 `/<defaultLocale>`。

设定 `prefixDefaultLocale: true` 时，Astro将会同时在你的`routing`配置对象中自动设定`redirectToDefaultLocale: true`。默认情况下，`src/pages/index.astro` 文件将会被自动重定向为你的默认语言的主页。

你可以通过 [设定 `redirectToDefaultLocale: false`](/zh-cn/reference/configuration-reference/#i18nroutingredirecttodefaultlocale)来避免Astro进行自动配置。这样可以让你拥有一个站点首页，它存在于你配置的语言文件夹结构之外。

#### `domains` (实验性)

<p><Since v="4.3.0" /></p>

这个路由选项允许你在使用 [`@astrojs/node`](/zh-cn/guides/integrations-guide/node/) 或 [`@astrojs/vercel`](/zh-cn/guides/integrations-guide/vercel/) 适配器，并配置了 site 的 server 渲染项目中，基于每种语言自定义你的域名。

要在项目中启用这个功能，如果你还没有[配置i18n路由](#配置i18n路由)，根据你的偏好进行相应配置。然后将 `experimental.i18nDomains` 标志设置为 `true`，并添加 `i18n.domains` 来映射你支持的任何 `locales` 到自定义的 URL：

```js title="astro.config.mjs" {3-7} ins={14-21}
import { defineConfig } from "astro/config"
export default defineConfig({
  site: "https://example.com",
  output: "server", // required, with no prerendered pages
  adapter: node({
    mode: 'standalone',
  }),
  i18n: {
    defaultLocale: "en",
    locales: ["es", "en", "fr", "ja"],
    routing: {
      prefixDefaultLocale: false
    },
    domains: {
        fr: "https://fr.example.com",
        es: "https://example.es"
    }
  },
  experimental: {
    i18nDomains: true
  }
})
```
所有未映射的 `locales` 将遵循你的 `prefixDefaultLocales` 进行配置。然而，即使此值为 `false`，你的 `defaultLocale` 的页面文件也必须存在于一个本地化的文件夹中。对于上面的配置，一个 `/en/` 文件夹是必需的。

使用上面的配置后：

- 文件 `/fr/about.astro` 将创建 URL `https://fr.example.com/about`。
- 文件 `/es/about.astro` 将创建 URL `https://example.es/about`。
- 文件 `/ja/about/astro` 将创建 URL `https://example.com/ja/about`。
- 文件 `/en/about.astro` 将创建 URL `https://example.com/about`。

上述URL也将作为 `getAbsoluteLocaleUrl()` 和 `getAbsoluteLocaleUrlList()` 函数的返回值。

##### 限制条件

该功能具有一些限制条件：
- `site` 选项是强制性的。
- `output` 选项必须设置为 `"server"`。
- 不能有任何单独的预渲染页面。
- 不支持适配器特性 [`functionPerRoute`](/zh-cn/reference/adapter-reference/#functionperroute)。

Astro为了实现这些特性，将依赖下面的请求头：
- [`X-Forwarded-Host`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Forwarded-Host) 与 [`Host`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Host)。Astro 将使用前者，如果前者不存在，则尝试使用后者。
- 服务器请求的[`X-Forwarded-Proto`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Forwarded-Proto) 与 [`URL#protocol`](https://developer.mozilla.org/zh-CN/docs/Web/API/URL/protocol)。

确保你的服务器代理/托管平台能够提供这些信息。如果无法检索到这些标头，将加载 404（状态代码）页面。

#### 路由逻辑

Astro 使用一个 [中间件](/zh-cn/guides/middleware/) 来实现其路由逻辑。这个中间件函数被放置在 [第一个位置](/zh-cn/guides/middleware/#中间件链式调用) ，它在任何额外中间件和每个页面路由返回的 `Response` 之前等待，最后执行自己的逻辑。

这意味着你自己的中间件和页面逻辑的操作（例如重定向）首先运行，然后渲染你的路由，然后 i18n 中间件才执行自己的动作，例如验证本地化 URL 是否对应有效的路由。

### `defaultLocale` 与 `locales`

在你的 `i18n` 路由配置中必须同时定义一种默认语言([`defaultLocale`](/zh-cn/reference/configuration-reference/#i18ndefaultlocale))和一份所有支持的语言的清单([`locales`](/zh-cn/reference/configuration-reference/#i18nlocales))。

`locales` 配置数组中的每个条目必须是一个字符串（例如 `"fr"`、`"pt-br"`）或一个[自定义语言路径](#自定义语言路径)。`locales` 可以包含字符串和自定义路径的组合。

你的 `/[locale]/` 文件夹名称必须与列表中的 `locale` 完全匹配（无论是字符串还是 `path` 值），并且你的 [`routing`](#routing) 配置必须对应于你是否有一个用于默认语言的本地化文件夹。其他每种支持的语言都必须有自己的本地化文件夹。

根据你的部署环境，你可能会发现 URL 路径上的转换，因此请检查你部署的站点，以确定你的 `locale` 值的最佳语法。

### 自定义语言路径

除了将站点支持的 `locales` 定义为字符串（例如 "en"、"pt-br"）之外，Astro 还允许你将任意数量的[浏览器识别的语言 `codes`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language#%E8%AF%AD%E6%B3%95)映射到自定义的 URL `path`。虽然 `locales` 可以是任何格式的字符串，只要它们与你的项目文件夹结构相对应，但 `codes` 必须遵循浏览器接受的语法。

将一个带有 `path` 键的对象传递给 `locales` 数组以定义自定义的 URL 前缀。，并使用 `codes` 指示映射到此 URL 的语言。在这种情况下，你的 `/[locale]/` 文件夹名称必须与 `path` 的值完全匹配，你的 URL 将使用 `path` 的值生成。

如果你支持一个语言的多个变体（例如 `"fr"`、`"fr-BR"` 和 `"fr-CA"`），并且希望将所有这些变体都映射到同一个 URL `/fr/` 下，甚至完全自定义它（例如 `/french/`），下面的配置将非常有效：

```js title="astro.config.mjs" del={5} ins={6-9}
import { defineConfig } from "astro/config"
export default defineConfig({
  i18n: {
    defaultLocale: "en",
    locales: ["es", "en", "fr"],
    locales: ["es", "en", {
        path: "french", // no slashes included
        codes: ["fr", "fr-BR", "fr-CA"]
    }],
    routing: {
        prefixDefaultLocale: true
    }
  }
})
```

当使用 [`astro:i18n`虚拟化模块](#虚拟化模块astro:i18n) 中的函数根据你的配置计算有效的 URL 路径（例如 `getRelativeLocaleUrl()`）时，[使用 `path` 作为 `locale` 的值](#根据自定义路径生成URL)。

### 浏览器语言检测

Astro的i18n路由与Astro的[按需服务器渲染模式 (`output:'server'` 或 `output:'hybrid'`)](/zh-cn/guides/server-side-rendering/)结合，允许你访问两个属性用于浏览器语言检测：`Astro.preferredLocale` 与 `Astro.preferredLocaleList`。

他们将结合浏览器的 Accept-Language 标头和你的 locales（字符串或 codes），自动优先匹配你的访客的首选语言。

- `Astro.preferredLocale`: 如果访问者的浏览器首选语言在你的 `locales` 数组中，Astro 可以计算一个**首选的区域设置**。如果没有这样的匹配，则此值为未定义。
- `Astro.preferredLocaleList`: 包含浏览器请求的所有语言和你的网站支持的所有语言的数组。这产生了你的站点和你的访问者之间所有兼容语言的列表。如果浏览器的请求语言中没有在你的 `locales` 数组中找到，则该值为 `[]`。如果浏览器没有指定任何首选语言，则该值将为 [`i18n.locales`]。
- `Astro.currentLocale`: 从当前 URL 计算出的区域设置，使用你的 `locales` 配置中指定的语法。如果 URL 不包含 `/[locale]/` 前缀，则该值将默认为 `i18n.defaultLocale`。

为了成功匹配你的访客的语言偏好，提供与[浏览器使用](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language#%E8%AF%AD%E6%B3%95)的相同模式的`codes`。

### 回退

Astro 的 i18n 路由允许你配置一个**回退路由策略**。当一个语言中的页面不存在（例如，尚未翻译的页面），而不是显示 404 页面，你可以基于每种语言的基础将用户从一个地区重定向到另一个地区。当你还没有为每个路由创建页面，但你仍然想向你的访问者提供一些内容时，这是很有用的。

例如，下面的配置将 `es` 设置为任何缺失 `fr` 路由的回退语言。这意味着当 `src/pages/fr/my-page.astro` 不存在时，访问 `example.com/fr/my-page/` 的用户将被重定向到 `example.com/es/my-page/` 并显示其内容，而不是被重定向到 404 页面。

```js title="astro.config.mjs" ins={6-8} 
import { defineConfig } from "astro/config"
export default defineConfig({
  i18n: {
    defaultLocale: "en",
    locales: ["es", "en", "fr"],
    fallback: {
      fr: "es"  
    }
  }
})
```

Astro 将确保为 `src/pages/es/` 中存在的每个页面构建一个对应的页面在 `src/pages/fr/` 中。如果页面尚不存在，Astro将创建一个页面，并将其重定向到相应的 `es` 路由。

## 虚拟化模块`astro:i18n`

这个模块提供了一些函数，可以帮助你使用项目配置的语言环境创建URL。

使用i18n router为项目创建路由将取决于你设置的一些配置值，这些配置值会影响到你的页面路由。在使用这些函数创建路由时，请确保考虑到你的个别设置：

- [`base`](/zh-cn/reference/configuration-reference/#base)
- [`trailingSlash`](/zh-cn/reference/configuration-reference/#trailingslash)
- [`build.format`](/zh-cn/reference/configuration-reference/#buildformat)
- [`site`](/zh-cn/reference/configuration-reference/#site)

另外请注意，这些函数将根据你的 `i18n.routing` 配置创建返回URL。

当配置为 `prefixDefaultLocale: true` 时创建的URL将在URL中包含 `/lang/` 路径。当配置为 `prefixDefaultLocale: false` 时创建的URL将不包含语言前缀。

### `getRelativeLocaleUrl()`

`getRelativeLocaleUrl(locale: string, path: string, options?: GetLocaleOptions): string`

Use this function to retrieve a relative path for a locale. If the locale doesn't exist, Astro throws an error. 

```astro
---
getRelativeLocaleUrl("fr");
// returns /fr

getRelativeLocaleUrl("fr", "");
// returns /fr

getRelativeLocaleUrl("fr", "getting-started");
// returns /fr/getting-started

getRelativeLocaleUrl("fr_CA", "getting-started", {
  prependWith: "blog"
}); 
// returns /blog/fr-ca/getting-started

getRelativeLocaleUrl("fr_CA", "getting-started", {
  prependWith: "blog",
  normalizeLocale: false
}); 
// returns /blog/fr_CA/getting-started
---
```

### `getAbsoluteLocaleUrl()` 

`getAbsoluteLocaleUrl(locale: string, path: string, options?: GetLocaleOptions): string`


Use this function to retrieve an absolute path for a locale when [`site`] has a value. If [`site`] isn't configured, the function returns a relative URL. If the locale doesn't exist, Astro throws an error.


```astro title="src/pages/index.astro"
---
// If `site` is set to be `https://example.com`

getAbsoluteLocaleUrl("fr"); 
// returns https://example.com/fr

getAbsoluteLocaleUrl("fr", ""); 
// returns https://example.com/fr

getAbsoluteLocaleUrl("fr", "getting-started"); 
// returns https://example.com/fr/getting-started

getAbsoluteLocaleUrl("fr_CA", "getting-started", {
  prependWith: "blog"
}); 
// returns https://example.com/blog/fr-ca/getting-started

getAbsoluteLocaleUrl("fr_CA", "getting-started", {
  prependWith: "blog",
  normalizeLocale: false
}); 
// returns https://example.com/blog/fr_CA/getting-started
---
```

### `getRelativeLocaleUrlList()`

Use this like [`getRelativeLocaleUrl`](#getrelativelocaleurl) to return a list of relative paths for all the locales.


`getRelativeLocaleUrlList(path?: string, options?: GetLocaleOptions): string[]`

### `getAbsoluteLocaleUrlList()`

`getAbsoluteLocaleUrlList(path?: string, options?: GetLocaleOptions): string[]`

Use this like [`getAbsoluteLocaleUrl`](#getabsolutelocaleurl) to return a list of absolute paths for all the locales.

### `getPathByLocale(locale: string): string`

A function that returns the `path` associated to one or more `codes` when [custom locale paths](#custom-locale-paths) are configured.

### Generating URLs from custom paths

When a `locale` is a custom path, use the `path` as the value for `locale`.

For example, use `french` in the i18n helper functions for the `locales` configuration below:

```js
locales: ["es", "en", {
  path: "french",
  codes: ["fr", "fr-BR", "fr-CA"]
}],
```

```astro title="src/pages/index.astro"
---
import { getPathByLocale, getRelativeLocaleUrl, getLocaleByPath } from "astro:i18n";

getRelativeLocaleUrl("french", "blog"); // returns /french/blog
---
```
Note that other `astro:i18n` functions will return the following results for the same configuration:
 
```astro title="src/pages/index.astro"
---
getPathByLocale("fr"); // returns "french"
getPathByLocale("fr-CA"); // returns "french"
getLocaleByPath("french"); // returns "fr" because that's the first code configured
---
```

### `getLocaleByPath(path: string): string`

A function that returns the `code` associated to a locale `path`.

### Retrieve the locale for a custom path

Given a custom path configured with multiple `codes`, the function will return the **first** code configured:

```js
// astro.config.mjs
import {defineConfig} from "astro/config"
export default defineConfig({
    i18n: {
        defaultLocale: "en",
        locales: ["en", "es", "fr", {
            path: "portugues",
            codes: ["pt-AO", "pt", "pt-BR"]
        }]
    }
})
```

```astro
---
// src/pages/index.astro
import { getLocaleByPath } from "astro:i18n";
console.log(getLocaleByPath("en")) // will log "en"
console.log(getLocaleByPath("fr")) // will log "fr"
console.log(getLocaleByPath("portugues")) // will log "pt-AO"
---
```

[`site`]: /en/reference/configuration-reference/#site
[`i18n.locales`]: /en/reference/configuration-reference/#i18nlocales
