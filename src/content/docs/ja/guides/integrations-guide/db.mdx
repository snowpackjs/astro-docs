---
type: integration
title: '@astrojs/db'
description: Learn how to use the @astrojs/db integration in your Astro project.
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/db/'
category: other
i18nReady: true
---
import { FileTree } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';
import ReadMore from '~/components/ReadMore.astro';
import Badge from '~/components/Badge.astro';


Astro DBはAstroの為に設計されたSQLベースのデータベースです。ローカル環境で開発し[Astro Studio dashboard](/en/recipes/studio/)からデプロイしましょう。

強力なローカルの型安全ツールを備えたAstro DBを使用し、リレーショナルデータベースとしてコンテンツをモデル、またはクエリしましょう。 Interactive Studio Dashboardからあなたのリモートなデータをホストされているリモートデータを表示、管理、デプロイする事が出来ます。 

<ReadMore>AstroDBの詳しい例や使い方に関しては[Astro DBガイド](/en/guides/astro-db/)をご覧ください</ReadMore>

## インストール

Astroは公式インテグレーションのセットアップを自動化するために標準で`astro add`コマンドを搭載しています。自動で行われたくない場合、[手動でインテグレーションをインストール](#手動でのインストール) する事もできます。

以下のコマンドの内いずれか一つをターミナルで実行してください。

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add db
    ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add db
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add db
  ```
  </Fragment>
 </PackageManagerTabs>

#### 手動でのインストール

AstroDBのインストールを手動で行いたい場合、 `astro add`コマンドを実行するのではなく以下のステップに従って手動でインストールしてください。 

##### 1. npmのパッケージマネージャー経由でインテグレーションをインストールする

   <PackageManagerTabs>
     <Fragment slot="npm">
     ```shell
     npm install @astrojs/db
     ```
     </Fragment>
     <Fragment slot="pnpm">
     ```shell
     pnpm add @astrojs/db
     ```
     </Fragment>
     <Fragment slot="yarn">
     ```shell
     yarn add @astrojs/db
     ```
     </Fragment>
   </PackageManagerTabs>

##### 2.  インテグレーションを`astro.config.mjs`に追加する

    ```js title="astro.config.mjs" ins={2,6}
    import { defineConfig } from 'astro/config';
    import db from '@astrojs/db';

    export default defineConfig({
      integrations: [
       db()
      ]
    });
    ```

##### 3. データベースを設定する

プロジェクトディレクトリの一番高い階層に`db/config.ts`を作成してください。このファイルはAstroが自動的にロードしテーブルを設定するのに使用されます。

```ts
// db/config.ts
import { defineDb } from 'astro:db';

export default defineDb({
  tables: {},
})
```

## テーブル構成の参照

### `columns`

テーブルの行の設定をするにはは以下のコードのように`columns`オブジェクトを使用します。

```ts
import { defineTable, column, NOW } from 'astro:db';

const Comment = defineTable({
	columns: {
		id: column.number({ primaryKey: true }),
		author: column.text(),
		content: column.text({ optional: true }),
		published: column.date({ default: NOW }),
	},
});
```

テーブルの行を細かく設定するには `column`ユティリティーを使用します。 `column`は以下の型に対応しています。

- **`column.text(...)`** - プレーンまたはリッチテキストを保存する
- **`column.number(...)`** - 整数(Integer)や小数(Float)を保存する
- **`column.boolean(...)`** - true、またはfalseのいずれかの値を保存する
- **`column.date(...)`** - `Date` objects, parsed as ISO strings for data storage
- **`column.json(...)`** - store arbitrary JSON blobs, parsed as stringified JSON for data storage

以下の追加設定は全ての型の行で使用できます。

- `primaryKey` - Set a `number` or `text` column as the unique identifier.
- `optional` - Astro DB uses `NOT NULL` for all columns by default. Set `optional` to `true` to allow null values.
- `default` - Set the default value for newly inserted entries. This accepts either a static value or a string of `sql` for generated values like timestamps.
- `unique` - Mark a column as unique. This prevents duplicate values across entries in the table.
- `references` - Reference a related table by column. This establishes a foreign key constraint, meaning each column value must have a matching value in the referenced table.  

### `indexes`

Table indexes are used for improve lookup speeds on a given column or combination of columns. The `indexes` property accepts an object with a unique index name as the key:

```ts title="db/config.ts" {6-8}
import { defineTable, column } from 'astro:db';

const Comment = defineTable({
  authorId: column.number(),
  body: column.text(),
  indexes: {
    author_idx: { on: ['authorId'], unique: true },
  }
});
```

The following configuration options are available for each index:

- `on`: `string | string[]` - A single column or array of column names to index.
- `unique`: `boolean` - Set to `true` to enforce unique values across the indexed columns.

### `foreignKeys`

:::tip

`foreignKeys` is an advanced API for relating multiple table columns. If you only need to reference a single column, try using [the column `references` property.](#columns)

:::

Foreign keys are used to establish a relationship between two tables. The `foreignKeys` property accepts an array of configuration objects that may relate one or more columns between tables:

```ts title="db/config.ts" {12-20}
import { defineTable, column } from 'astro:db';

const Author = defineTable({
  firstName: column.text(),
  lastName: column.text(),
});

const Comment = defineTable({
  authorFirstName: column.text(),
  authorLastName: column.text(),
  body: column.text(),
  foreignKeys: [
    {
      columns: ['authorFirstName', 'authorLastName'],
      references: () => [
        Author.columns.firstName,
        Author.columns.lastName
      ],
    },
  ]
});
```

Each foreign key configuration object accepts the following properties:

- `columns`: `string[]` - An array of column names to relate to the referenced table.
- `references`: `() => Column[]` - A function that returns an array of columns from the referenced table.

## Astro DB CLI reference

Astro DB includes a set of CLI commands to interact with your hosted project database and your [Astro Studio](/en/recipes/studio/) account. 

These commands are called automatically when using a GitHub CI action, and can be called manually using the `astro db` CLI. 

### `astro db push`

**Flags:**

- `--force-reset` Reset all production data if a breaking schema change is required.

Safely push database configuration changes to your project database. This will check for any risk of data loss and guide you on any recommended migration steps. If a breaking schema change must be made, use the `--force-reset` flag to reset all production data.

### `astro db verify`

Check for any differences between your local and remote database configurations. This is automatically run by `astro db push`. `verify` will compare your local `db/config.ts` file with the remote database and warn if changes are detected.

### `astro db execute <file-path>`

**Flags:**

- `--remote` Run against your Studio project database. Omit to run against your development server.

Execute a `.ts` or `.js` file to read or write to your database. This accepts a file path as an argument, and supports usage of the `astro:db` module to write type-safe queries. Use the `--remote` flag to run against your Studio project database, or omit the flag to run against your development server. See how to [seed development data](/en/guides/astro-db/#seed-your-database) for an example file.

### `astro db shell --query <sql-string>`

**Flags:**

- `--query` Raw SQL query to execute.
- `--remote` Run against your Studio project database. Omit to run against your development server.

Execute a raw SQL query against your database. Use the `--remote` flag to run against your Studio project database, or omit the flag to run against your development server.
