---
title: Astro v5.0-beta
description: Documentation for Astro v5.0-beta projects
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import { Steps } from '@astrojs/starlight/components';

## LINEAR ISSUES MARKED AS COMPLETED BUT STILL REQUIRING ATTENTION

- (PLT-2347) Figure out where Zod comes from -- I THINK THIS WILL NEED DOCS, BUT NO TASK FOR IT

## LINEAR ISSUES CONFIRMED AS NON-BREAKING

-


## LINEAR ISSUES NOT (YET?) MARKED AS BREAKING IN LINEAR - I HAVE MY DOUBTS

If completed, would any of these require a change to existing documentation??

- (PLT-989) Rework `supportedAstroFeatures.assets`
- (PLT-1768) Think about `trailingSlash` again
- (PLT-1805) [url encoded dynamic params not properly handled - PR 8561](https://github.com/withastro/astro/issues/8516)
- (PLT-1897) Move `__astroHeadings` and `imagePaths` into `vfile.data.astro`
- (PLT-1938) Refactor Astro Compiler
- (PLT-1946) Fix shiki syntax highlighting to output hast for performance
- (PLT-1961) Go through TODOs in the codebase
- (PLT-1993) Allow new URL in integration APIs
- (PLT-2149) Allow customizing the redirect page
- (PLT-2151) Redesign 404 / 500 special-cased components
- (PLT-2171) Make `build.client` and `build.server` predictable
- (PLT-2315) Remove collection item types
- (PLT-2331) [Nested components in server:defer - PR 11581](https://github.com/withastro/astro/issues/11518)
- (PLT-2338) Expose `RouteData[]` to integrations
- (PLT-2339) Expose the current route via `Astro.route`
- (PLT-2342) prerender on `RouteData` is weird
- (PLT-2343) Fix prerendering
- (PLT-2344) Make `src/env.d.ts` optional
- (PLT-2345) `trailingSlash`, don't apply to endpoints
- (PLT-2423) Consider renaming ViewTransitions component


## Main page starts here 

This guide will help you migrate from Astro v4 to Astro v5.

Need to upgrade an older project to v4? See our [older migration guide](/en/guides/upgrade-to/v4/).

{/* Need to see the v4 docs? Visit this [older version of the docs site (unmaintained v3.6 snapshot)](https://docs-git-v3-docs-unmaintained-astrodotbuild.vercel.app/). */}


## Upgrade Astro

{/* Update your project's version of Astro and all official integrations to the latest versions using your package manager.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # Upgrade Astro and official integrations together
  npx @astrojs/upgrade
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # Upgrade Astro and official integrations together
  pnpm dlx @astrojs/upgrade
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # Upgrade Astro and official integrations together
  yarn dlx @astrojs/upgrade
  ```
  </Fragment>
</PackageManagerTabs>

You can also [upgrade your Astro integrations manually](/en/guides/integrations-guide/#manual-upgrading) if needed, and you may also need to upgrade other dependencies in your project. */}

Update your project's version of Astro to the latest beta version using your package manager:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # Upgrade Astro and official integrations together
  npx @astrojs/upgrade
  //NEED A V5 SPECIFIC COMMAND, AND NOW TO KNOW THE LATEST
  // HOW TO UPGRADE INTEGRATIONS w BETA?
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # Upgrade Astro and official integrations together
  pnpm dlx @astrojs/upgrade
  //NEED A V5 SPECIFIC COMMAND, AND NOW TO KNOW THE LATEST
  // HOW TO UPGRADE INTEGRATIONS w BETA?
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # Upgrade Astro and official integrations together
  yarn dlx @astrojs/upgrade
  //NEED A V5 SPECIFIC COMMAND, AND NOW TO KNOW THE LATEST
  // HOW TO UPGRADE INTEGRATIONS w BETA?
  ```
  </Fragment>
</PackageManagerTabs>

You can also [upgrade your Astro integrations manually](/en/guides/integrations-guide/#manual-upgrading) if needed, and you may also need to upgrade other dependencies in your project.

:::note[Need to continue?]
After upgrading Astro, you may not need to make any changes to your project at all!

But, if you notice errors or unexpected behavior, please check below for what has changed that might need updating in your project.
:::

Astro v5.0 includes [potentially breaking changes](#breaking-changes), as well as the [removal of some previously deprecated features](#previously-deprecated-features-now-removed).

If your project doesn't work as expected after upgrading to v5.0, check this guide for an overview of all breaking changes and instructions on how to update your codebase.

See [the changelog](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) for full release notes. * GET EXACT LINK WHEN AVAILABLE

## Astro v5.0 Experimental Flags Removed

The following features are no longer experimental in Astro v5.0:

- `actions`
- `directRenderScript` - THIS MIGHT CHANGE YOUR PROJECT NOW???? IS DEFAULT DIFFERENT? PLT-2086
- `globalRoutePriority`
- `rewrites`
- `env`
- `serverIslands`
- `contentLayer`

Remove their experimental flags if you were previously using them, and move your `env` configuration to the root of your Astro config:

```js del={5-12} ins={14-16} title="astro.config.mjs"
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
    actions: true,
    contentLayer: true,
    directRenderScript: true,
    globalRoutePriority: true,
    rewrites: true,
    serverIslands: true,
    env: {
      schema: {...}
    }
  },
  env: {
      schema: {...}
  }
})
```

These features are all available by default in Astro v5.0. Only `astro:env` requires any configuration to use.

Read about these exciting features and more in [the v5.0-beta Blog post](https://astro.build/blog/astro-4/). * UPDATE LINK


## Upgrades


### Node Support

Astro v5.0 raises the minimum supported version of Node.js to `v18.17.1`

#### What should I do?

 Check that both your development environment and your deployment environment are using **Node `18.17.1` or higher**.

<Steps>
1. Check your local version of Node using:

    ```sh
    node -v
    ```

2. Check your [deployment environment's](/en/guides/deploy/) own documentation to verify that they support this version of Node.

    You can specify Node `18.17.1` for your Astro project either in a dashboard configuration setting or a `.nvmrc` file.

    ```bash title=".nvmrc"
    18.17.1
    ```
</Steps>

{/*
// THESE ARE FOR DEPENDENCY UPGRADES

Any major upgrades to Astro's dependencies may cause breaking changes in your project.

### Upgraded: Vite 5.0

Placeholder

#### What should I do?

If you are using Vite-specific plugins, configuration, or APIs, check the [Vite migration guide](https://vitejs.dev/guide/migration) for their breaking changes and upgrade your project as needed. There are no breaking changes to Astro itself.

*/}

## Breaking Changes

The following changes are considered breaking changes in Astro v5.0. Breaking changes may or may not provide temporary backwards compatibility.

{/* If you need to refer to the documentation for a v4.x project, you can browse this [(unmaintained) snapshot of the docs from before v4.0 was released](https://docs-git-v3-docs-unmaintained-astrodotbuild.vercel.app/). */}

### Removed: some public-facing types (PLT844 - alpha.0)

In Astro v4.x, `@types/astro.ts` exposed all types publicly to users, whether or not they were still actively used or only intended for internal use.

Astro v5.0 refactors this file to [remove outdated and internal types](https://github.com/withastro/astro/pull/11715). This refactor brings improvements to your editor (e.g. faster completions, lower memory use, more relevant completion options). However, this refactor may cause errors in some projects that have been relying on types that are no longer available to the public.

#### What should I do?

Remove any types that now cause errors in your project as you no longer have access to them. These will be mostly previously deprecated and removed APIs, but may also include types that are now internal.


### Changed: CSRF protection is now set by default (PLT2262)

In Astro v4.0, The default value of `security.checkOrigin` was `false`. Previously, you had to explicitly set this value to `true` to enable Cross-Site Request Forgery (CSRF) protection.

Astro v5.0 changes the default value  of this option to `true`, and will automatically check that the "origin" header matches the URL sent by each request in on-demand rendered pages.

#### What should I do?

If you had previously configured `security.checkOrigin: true`, you no longer need this line in your Astro config. This is now the default.

To disable this behaviour, you must explicitly set  `security.checkOrigin: false`.

```js title="astro.config.mjs" del={3-5}
export default defineConfig({
  output: "server",
  security: {
    checkOrigin: true
  }
})
```

### Changed: `--mode` usage (PLT2220)

Rethink `--mode` and internal mode usage

#### What should I do?

Stuff!

### Changed: add base to `paginate` (PLT2204)

In Astro v4.x, the URL returned by `paginate()` (e.g. `page.url.next`, `page.url.first` etc.) did not include the value set for `base` in your Astro config. You had to manually prepend your configured value for `base` to the URL path.

Astro 5.0 automatically includes the `base` value in `page.url`.

#### What should I do?

If you are using the `paginate()` function for "previous" and "next" URLs, remove any existing `base` value as it is now added for you:

```astro del={16} ins={17}
---
export async function getStaticPaths({ paginate }) {
  const astronautPages = [{
    astronaut: 'Neil Armstrong',
  }, {
    astronaut: 'Buzz Aldrin',
  }, {
    astronaut: 'Sally Ride',
  }, {
    astronaut: 'John Glenn',
  }];
  return paginate(astronautPages, { pageSize: 1 });
}
const { page } = Astro.props;
// `base: /'docs'` configured in `astro.config.mjs`
const prev = "/docs" + page.url.prev;
const prev = page.url.prev;
---
<a id="prev" href={prev}>Back</a>
```

### Changed: auto-inject `<meta charset="utf-8">` by default for every astro/md/mdx/html (PLT1057)

Decide if charset=utf-8 should not be set for md/mdx pages by default

#### What should I do?

Stuff!

### Changed: `astro:content` can no longer be used on the client

The `astro:content` module can no longer be used on the client. It was never intentionally exposed for client usage, leading to some developers to use it without realizing the limitations and bloat to client bundles.

If currently using in the client, consider instead passing the data you need through properties to your client components:

```astro
---
import { getCollection } from 'astro:content';
import ClientComponent from '../components/ClientComponent';

const posts = await getCollection('blog');
const postsData = posts.map(post => post.data);
---

<ClientComponent posts={postsData} />
```

#### What should I do?

Stuff!

### Changed: `astro:config:setup` now passes `AstroUserConfig` so integrations can change config (PLT1776)

Revisit configuration passed to integrations

#### What should I do?

Stuff!

### Changed: set `ssr.external: true` when using Vite to load configs (PLT1631)

To consider - set `ssr.external: true` when using Vite to load configs

#### What should I do?

Stuff!

### Changed: `<script type="module">` no longer implies `is:inline` (PLT1548)

COnsider supporting `type="module"` for people who want to set it explicitly

#### What should I do?

Stuff!

### Changed: Shiki `css-variables` theme color token names (PLT1626)

In Astro v4.0, the Shiki `css-variables` theme uses the `--astro-code-color-text` and `--astro-code-color-background` tokens for styling the foreground and background colors of code blocks respectively.

Astro v5.0 renames them to `--astro-code-foreground` and `--astro-code-background` tokens respectively to better align with the Shiki v1 defaults.

#### What should I do?

You can perform a global find and replace in your project to migrate to the new token names.

```diff lang="css"
:root {
-  --astro-code-color-text: #000;
-  --astro-code-color-background: #fff;
+  --astro-code-foreground: #000;
+  --astro-code-background: #fff;
}
```

### Changed: Correctly render non-boolean HTML attribute values (PLT2279 - alpha.0)

In Astro v4.0, non-[boolean HTML attributes](https://developer.mozilla.org/en-US/docs/Glossary/Boolean/HTML) may not have included their values when rendered to HTML.

Astro v5.0 renders the values explicitly as `="true"` or `="false"`, matching proper attribute handling in browsers.

In the following `.astro` examples, only `allowfullscreen` is a boolean attribute:

```astro
<!-- src/pages/index.astro -->
<!-- `allowfullscreen` is a boolean attribute -->
<p allowfullscreen={true}></p>
<p allowfullscreen={false}></p>
<!-- `inherit` is *not* a boolean attribute -->
<p inherit={true}></p>
<p inherit={false}></p>
<!-- `data-*` attributes are not boolean attributes -->
<p data-light={true}></p>
<p data-light={false}></p>
```

Astro v5.0 now preserves the full data attribute with its value when rendering the HTML of non-boolean attributes:

```diff lang="astro"
  <p allowfullscreen></p>
  <p></p>

  <p inherit="true"></p>
- <p inherit></p>
+ <p inherit="false"></p>

- <p data-light></p>
+ <p data-light="true"></p>
- <p></p>
+ <p data-light="false"></p>
```

#### What should I do?


If you rely on attribute values, for example to locate elements or to conditionally render, update your code to match the new non-boolean attribute values:

```diff lang="js"
- el.getAttribute('inherit') === ''
+ el.getAttribute('inherit') === 'false'

- el.hasAttribute('data-light')
+ el.dataset.light === 'true'
```

### Removed: top level await in `vite-plugin-markdown`'s `astro:assets` (PLT1323 - alpha.1)

In Astro 4.x, included top level await in Markdown modules. This caused some issues with custom image services and images inside Markdown, causing Node to suddenly exit with no error message.

Astro 5.0 makes the `compiledContent()` property on Markdown imports an async function, requiring an `await` to resolve the content.

#### What should I do?

Update your code to use `await` when calling `compiledContent()`.

```diff lang="astro
---
import * as myPost from "../post.md";

- const content = myPost.compiledContent();
+ const content = await myPost.compiledContent();
---

<Fragment set:html={content} />
```

### Removed: Squoosh image service from core repo (PLT1380 - alpha.1)

In Astro 4.0, you could configure `image.service: squooshImageService()` to use Squoosh to transform your images instead of Sharp. However, the underlying library `libsquoosh` is no longer maintained and has memory and performance issues.

Astro 5.0 removes the Squoosh image optimization service entirely.

#### What should I do?

To switch to the built-in Sharp image service, remove the `squooshImageService` import from your Astro config. By default, you will use Sharp for `astro:assets`.

```ts title="astro.config.mjs" del={1, 5-7}
import { squooshImageService } from "astro/config";
import { defineConfig } from "astro/config";

export default defineConfig({
 image: {
   service: squooshImageService()
 }
});
```

If you are using a strict package manager like `pnpm`, you may need to install the `sharp` package manually to use the Sharp image service, even though it is built-in to Astro by default.

If your adapter for server or hybrid mode does not support Astro's built-in Sharp image optimization, you can [configure a no-op image service](/en/guides/images/#configure-no-op-passthrough-service) to allow you to use the `<Image />` and `<Picture />` components.

Alternatively, you may wish to consider [a community-maintained Squoosh image service](https://github.com/Princesseuh/astro-image-service-squoosh) if you are unable to use the Sharp image service.


##### For adapters

If your adapter previously precised its compatibility status with Squoosh, you should now remove this information from your adapter configuration.

```diff lang="ts" title="my-adapter.mjs"
supportedAstroFeatures: {
  assets: {
--    isSquooshCompatible: true,
  },
}
```

### Removed: Internal JSX exports entrypoints (PLT1935 - alpha.1)

In Astro v4.0, Astro performed internal JSX handling for the `@astrojs/mdx` integration.

Astro v5.0 moves this responsibility tohandle and render JSX and MDX the `@astrojs/mdx` package directly, and removes the following exports:

- `astro/jsx/babel.js`
 - `astro/jsx/component.js`
 - `astro/jsx/index.js`
 - `astro/jsx/renderer.js`
 - `astro/jsx/server.js`
 - `astro/jsx/transform-options.js`

#### What should I do?

If your project includes `.mdx` files, you must upgrade `@astrojs/mdx` to the latest version so that your JSX can be handled properly by the integration and no longer relies on these removed entrypoints.

## Deprecated

The following deprecated features are no longer supported and are no longer documented. Please update your project accordingly.

Some deprecated features may temporarily continue to function until they are completely removed. Others may silently have no effect, or throw an error prompting you to update your code.

### Deprecated: `functionPerRoute` (Adapter API) (PLT2150 - alpha.0)

In Astro v4.x, you could opt in to creating a separate file for each route defined in the project, mirroring your `src/pages/` directory in the build folder. By default, Astro emitted a single `entry.mjs` file, which was responsible for emitting the rendered page on each request.

Astro v5.0 removes the option to opt out of the default behavior. This behavior is now standard, and non-configurable.


#### What should I do?

Remove the `functionPerRoute` property from your `adapterFeatures` configuration. It is no longer available.

```js title="my-adapter.mjs" del={10}
export default function createIntegration() {
  return {
    name: '@matthewp/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@matthewp/my-adapter',
          serverEntrypoint: '@matthewp/my-adapter/server.js',
          adapterFeatures: {
              functionPerRoute: true
          }
        });
      },
    },
  };
}

```

### Deprecated: `build.format=file` (PLT1444) - PR WAS CLOSED??

In Astro v4.x, the `build.format: 'file'` option would build each page to files that matched the input name, rather than to directories with a `index.html` file inside. The input file `pages/about.astro` would become `dist/about.html`.

Astro v5.0 removes the option in favor of `build.format: 'preserve'`. The preserve option matches the input structure exactly, so if you have `pages/about.astro` it becomes `pages/about.html` (like with file). If you want to have a directory use the input file `pages/about/index.astro` instead.

#### What should I do?

Update your config to use `format: 'preserve'`. The only difference is that with `'file'` a directory with a `index.astro` / `index.md` would remove the directory and become a file instead. If you want to keep that behavior, move `about/index.astro` to `about.astro` instead.

### Deprecated: The Lit integration (integrations) (PLT2146)

In Astro v4.x, [Lit](https://lit.dev/) was a core-maintained framework library through the `@astrojs/lit` package.

Astro v5.0 removes the integration and it will not receive further updates for compatibility with 5.x and above.


#### What should I do?

You can continue to use Lit for client components simply by adding a client-side script tag. For example:

```astro
<script>
  import "../components/MyTabs";
</script>

<my-tabs title="These are my tabs">...</my-tabs>
```

If you're interested in maintaining a Lit integration yourself, you may wish to use the [last published version of `@astrojs/lit`](https://github.com/withastro/astro/tree/astro%404.13.0/packages/integrations/lit) as a starting point and upgrade the relevant packages.

### Deprecated: `define:vars` (core) (PLT2145)

In Astro v4.x,

Astro v5.0 removes the directive


#### What should I do?

Choose a different value

## Community Resources

Know a good resource for Astro v4.0? [Edit this page](https://github.com/withastro/docs/edit/main/src/content/docs/en/guides/upgrade-to/v4.mdx) and add a link below!

## Known Issues

Please check [Astro's issues on GitHub](https://github.com/withastro/astro/issues/) for any reported issues, or to file an issue yourself.
