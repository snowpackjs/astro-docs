---
title: 設定 Astro
i18nReady: true
---
import ReadMore from '~/components/ReadMore.astro'

要自訂 Astro 怎麽運作可以在你的專案加入 `astro.config.mjs` 檔案。這個在 Astro 專案是一個常見的檔案，所有官方的範例模板和主題預設都帶有一個。

<ReadMore>閱讀 Astro 的 [API 設定參考](/zh-tw/reference/configuration-reference/)以完整了解所有支援的設定選項。</ReadMore>

## Astro 設定檔案

一個有效的 Astro 設定檔案會使用推薦的 `defineConfig` 輔助函式，並且使用 `default` 輸出它的設定：

```js
// astro.config.mjs
import { defineConfig } from 'astro/config'

export default defineConfig({
  // 這邊放你的設定選項...
  // https://docs.astro.build/zh-tw/reference/configuration-reference/
})
```

我們推薦使用 `defineConfig()` 以在你的 IDE 中自動顯示型別提示，不過這不是必須的。一個最低限度的有效設定檔案看起來像這樣：

```js title="astro.config.mjs"
// 範例：最低限度的空設定檔案
export default {}
```

## 支援的設定檔案類型

Astro 的 JavaScript 設定檔案支援幾個檔案格式： `astro.config.js`、`astro.config.mjs`、`astro.config.cjs` 以及 `astro.config.ts`。我們推薦在多數情況下使用 `.mjs`，如果你想要用 TypeScript 寫設定檔案的話就用 `.ts`。

TypeScript 設定檔案的載入是透過 [`tsm`](https://github.com/lukeed/tsm) 處理的，並且會遵循你的專案的 tsconfig 選項。

## 解析設定檔案的位置

Astro 會自動嘗試在專案根目錄解析檔名是 `astro.config.mjs` 的設定檔案。如果在專案根目錄找不到設定檔案，會使用 Astro 的預設選項。

```bash
# 範例：從 ./astro.config.mjs 讀取你的設定
astro build
```

你可以用 `--config` 這個 CLI 選項明確指定設定檔案。這個 CLI 選項總是會以相對於你執行 `astro` CLI 指令的工作目錄的路徑進行解析。

```bash
# 範例：從這個檔案讀取你的設定
astro build --config my-config-file.js
```

## 設定的 IntelliSense

Astro 推薦在設定檔案中使用 `defineConfig()` 輔助函式。`defineConfig()` 提供了 IDE 中自動的 IntelliSense 功能。像 VSCode 之類的編輯器能夠讀取 Astro 的 TypeScript 型別定義，並提供自動的 jsdoc 型別提示，就算你的設定檔案不是用 TypeScript 寫的也行。

```js
// astro.config.mjs
import { defineConfig } from 'astro/config'

export default defineConfig({
  // 這邊放你的設定選項...
  // https://docs.astro.build/zh-tw/reference/configuration-reference/
})
```

你也可以手動向 VSCode 提供型別定義，只要使用這個 JSDoc 標註：

```js
// astro.config.mjs
export default /** @type {import('astro').AstroUserConfig} */ {
  // 這邊放你的設定選項...
  // https://docs.astro.build/zh-tw/reference/configuration-reference/
}
```

## 用相對路徑指定檔案

如果你提供一個相對路徑到 `root` 或 `--root` CLI 選項，Astro 會解析這個相對路徑，而不是你執行 `astro` CLI 指令的工作目錄。

```js
// astro.config.mjs
import { defineConfig } from 'astro/config'

export default defineConfig({
  // 解析到你現在的工作目錄下的 "./foo" 資料夾
  root: 'foo'
})
```

Astro 會將所有其他檔案和資料夾的相對路徑字串解析為相對於專案根目錄：

```js
// astro.config.mjs
import { defineConfig } from 'astro/config'

export default defineConfig({
  // 解析到你現在的工作目錄下的 "./foo" 資料夾
  root: 'foo',
  // 解析到你現在的工作目錄下的 "./foo/public" 資料夾
  publicDir: 'public',
})
```

要用相對於設定檔案的路徑指定檔案或資料夾，請使用 `import.meta.url`。（除非你是在寫 common.js 格式的 `astro.config.cjs` 檔案）

```js "import.meta.url"
// astro.config.mjs
import { defineConfig } from 'astro/config'

export default defineConfig({
  // 解析到相對於這個設定檔案的 "./foo" 資料夾
  root: new URL("./foo", import.meta.url).toString(),
  // 解析到相對於這個設定檔案的 "./public" 資料夾
  publicDir: new URL("./public", import.meta.url).toString(),
})
```

:::note 
Vite 特有的 `import.meta` 屬性，像是 `import.meta.env` 或 `import.meta.glob`，無法從你的設定檔案存取。對這些個別的使用案例，我們推薦用 [dotenv](https://github.com/motdotla/dotenv) 或是 [fast-glob](https://github.com/mrmlnc/fast-glob) 之類的替代品。此外 [tsconfig 的路徑別名](https://www.typescriptlang.org/tsconfig#paths)不會被解析，在這個檔案請使用相對路徑引入模組。
:::

## 客製化輸出檔名

對於 Astro 處理的程式碼，像是引入的 JavaScript 或 CSS 檔案，你可以為它們客製化輸出檔名，只要在 `astro.config.*` 檔案的 `vite.build.rollupOptions` 條目使用 [`entryFileNames`](https://rollupjs.org/configuration-options/#output-entryfilenames)、[`chunkFileNames`](https://rollupjs.org/configuration-options/#output-chunkfilenames)和[`assetFileNames`](https://rollupjs.org/configuration-options/#output-assetfilenames)。

```js ins={9-11}
// astro.config.mjs
import { defineConfig } from 'astro/config'

export default defineConfig({
  vite: {
    build: {
      rollupOptions: {
        output: {
          entryFileNames: 'entry.[hash].mjs',
          chunkFileNames: 'chunks/chunk.[hash].mjs',
          assetFileNames: 'assets/asset.[hash][extname]',
        },
      },
    },
  },
})
```

如果你的程式碼有可能會受到廣告攔截器影響的檔名（如 `ads.js` 或 `google-tag-manager.js`），這個可能會有幫助。

## 環境變數

Astro 會在它載入其他檔案前評估設定檔案。因此你不能使用 `import.meta.env` 存取在 `.env` 檔案設定的環境變數。

你可以在設定檔案使用 `process.env` 存取其他環境變數，像是由 CLI 設下的。

你也可以使用 [Vite 的 `loadEnv` 輔助函式](https://main.vite.dev/config/#using-environment-variables-in-config)手動載入 `.env` 檔案。

:::note
`pnpm` 不允許你引入沒有在專案中被直接安裝的模組。如果你用的是 `pnpm`，你需要安裝 `vite` 才能使用 `loadEnv` 輔助函式。
```sh
pnpm add vite --save-dev
```
:::

```js title="astro.config.mjs"
import { loadEnv } from "vite";
const { SECRET_PASSWORD } = loadEnv(process.env.NODE_ENV, process.cwd(), "");
```

## 設定參考

<ReadMore>閱讀 Astro 的 [API 設定參考](/zh-tw/reference/configuration-reference/)以完整了解所有支援的設定選項。</ReadMore>
