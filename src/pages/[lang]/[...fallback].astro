---
import languages from '../../i18n/languages';

export async function getStaticPaths() {
	const allPages = await Astro.glob('../**/*.md');
	const pagesByLang = allPages.reduce((pages, page) => {
		const lang = page.url.split('/')[1];
		if (!pages[lang]) pages[lang] = [];
		pages[lang].push(page);
		return pages;
	}, {} as { [lang: string]: typeof allPages });

	const paths = [];
	for (const { url, Content } of pagesByLang.en) {
		const slug = url.slice(4)
		for (const lang of Object.keys(languages)) {
			if (lang === 'en') continue;
			const doesNotNeedFallback = pagesByLang[lang]?.some(p => p.url === `/${lang}/${slug}`);
			if (doesNotNeedFallback) continue;
			paths.push({ params: { lang, fallback: slug }, props: { Content } });
		}
	}
	return paths;
}

// TODO: this is needed because some CSS goes missing using the Content component.
// Importing all components & layouts makes sure Astro picks up the CSS.
// This isnâ€™t ideal as it likely includes unnecessary styles, but at least works for now.
const components = import.meta.glob('../../components/**/*.astro');
const layouts = import.meta.glob('../../layouts/**/*.astro');

const { Content } = Astro.props;
---
<Content />
