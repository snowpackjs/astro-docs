---
layout: ~/layouts/MainLayout.astro
title: Test
description: Une introduction sur comment tester avec Astro 
i18nReady: false
---

import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'

Le test aide à ecrire et maintenir du code Astro. Astro supporte une variété d'outils pour tests unitaires, tests des Composants, et test de bout en bout comme Jest, Mocha, Jasmine, Cypress et Playwright. Vous pouvez même installer des librairies de test spécifique au Framework de votre choix, par exemple, React Testing Library pour tester vos Framework de Composants UI. 

Tester votre framework vous permet d'exprimer des **assertions** ou des **attentes** sur le comportement de votre code dans un cas spécifique, et ensuite comparer cela au comportement actuel de votre code. 

## Vittest

C'est un framework de test unitaires pour Vite avec ESM, TypeScript et JSX via esbuild.

Veuillez voir [Astro + Vitest starter template](https://github.com/withastro/astro/tree/latest/examples/with-vitest) sur Github.

## Playwright

Playwright est un framework de test de bout en bout pour des applications webs modernes. Utilisez les API(ou IPA) de Playwright en JavaScript ou TypeScript pour tester votre code Astro sur tous les moteurs de rendu y compris Chromium, WebKit et Firefox. 

### Installation

Vous pouvez commencer et éxecuter vos tests en utilisant [l'éxtension VS Code](https://playwright.dev/docs/getting-started-vscode)

Alternativement, vous pouvez installer Playwright à l' intérieur de votre projet Astro via votre gestionnaire de packages preféré. Suivez les instructions CLI pour choisir entre JavaScript et TypeScript, nommer votre dossier, et ajouter des Github Actions workflow facultatives.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  npm init playwright@latest
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  pnpm dlx create-playwright
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  yarn create playwright
  ```
  </Fragment>
</PackageManagerTabs>

### Créez votre premier test Playwright

1. Choisissez une page à tester. Dans l'exemple ci-dessous, on utilisera la page `index.astro`.

```html title="src/pages/index.astro"
---
---
<html lang="en">
  <head>
    <title>Astro is awesome!</title>
    <meta name="description" content="Pull content from anywhere and serve it fast with Astro's next-gen island architecture." />
  </head>
  <body></body>
</html>
```

2. Créez un nouveau dossier et ajouter le fichier suivant `src/test`. Copiez et collez le test suivant dans le fichier pour verifier que la méta de la page soit correct. Changez la contenu `<title>` de la page pour correspondre avec la page que vous testiez.

```jsx title="src/test/index.spec.ts" "Astro is awesome!"
import { test, expect } from '@playwright/test';

test('meta is correct', async ({ page }) => {
  await page.goto("http://localhost:3000/");

  await expect(page).toHaveTitle('Astro is awesome!');
});
```

:::tip[set a baseurl]
Vous pouvez definir le [`"baseURL": "http://localhost:3000"`](https://playwright.dev/docs/api/class-testoptions#test-options-base-url) dans le fichier de configuration `playwright.config.ts` pour pouvoir utiliser `page.goto("/")` au lieu de `page.goto("http://localhost:3000/")` pour un lien plus pratique.  
:::

### Executer vos tests Playwright 

Vous pouvez executer un seul test ou plusieurs test à la fois, testant un ou plusieurs navigateurs. Par défaut, les resultats de vos tests seront montrés sur votre terminal. Facultativement, vous pouvez ouvrir le HTML Test Reporter pour vous montrer un bilan complet et filtrer les resultats.    

1. Pour executer nos tests sur l'exemple précedant via la commande de ligne, utilisez le commande `test`. Facultativement, incluez le nom du fichier à tester pour un test singulier:

```sh
npx playwright test index.spec.ts
```

2. Pour voir le Bilan HTML complet, ouvrez-le avec la commande qui suive:
```sh
npx playwright show-report
```

:::tip
Executez vos tests contre le code de production pour mieux ressembler à votre site deployé.
:::

#### Avancé: Lancer un serveur de development pendant les tests

Vous pouvez aussi avoir Playwright lancer votre serveur quand vous executez votre script de test en utilisant l'option [`webServer`](https://playwright.dev/docs/test-advanced#launching-a-development-web-server-during-the-tests) dans le fichier de configuration Playwright.


Voici un exemple des configurations et commandes en via Yarn:

1. Ajouter un script de test à votre fichier `package.json` dans la racine du projet, tel que `"test:e2e:" "playwright test"`.

2. Dans `playwright.config.ts`, ajoutez l'objet `webServer` et changez la commande pour `yarn preview`.

```js title="playwright.config.ts" ins={3-8} "yarn preview"
import type { PlaywrightTestConfig } from '@playwright/test';
const config: PlaywrightTestConfig = {
  webServer: {
    command: 'yarn preview',
    url: 'http://localhost:3000/app/',
    timeout: 120 * 1000,
    reuseExistingServer: !process.env.CI,
  },
  use: {
    baseURL: 'http://localhost:3000/app/',
  },
};
export default config;
```
3. Executez `yarn build`, ensuite executez `yarn test:e2e` pour courir les tests Playwright.

Pour plus d'information, veuillez voir les liens ci-dessous:

- [Getting started with Playwright](https://playwright.dev/docs/intro)
- [Use a development server](https://playwright.dev/docs/test-advanced#launching-a-development-web-server-during-the-tests)
